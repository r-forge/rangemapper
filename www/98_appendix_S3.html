<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN" "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">

<head>
<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1" />
<meta name="generator" content="AsciiDoc 8.6.6" />

<title></title>

<link rel="stylesheet" href="style/asciidoc.css" type="text/css" />
<link rel="stylesheet" href="style/layout2.css" type="text/css" />
<link rel="stylesheet" href="style/tooltip.css" type="text/css" />

<script type="text/javascript">

          var _gaq = _gaq || [];
          _gaq.push(['_setAccount', 'UA-25987540-1']);
          _gaq.push(['_trackPageview']);

          (function() {
                var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
                ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
                var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
          })();
</script>




</head>

<body style="max-width:1024px">

<div id="layout-menu-box">

<div id="layout-menu">
<div>&#187;<a href="index.html">Home</a></div>
<div>&#187;<a href="faq.html">FAQ</a></div>
<div>&#187;<a href="gui.html">GUI</a></div>
<div>&#187;<a href="bibliography.html">Bibliography</a></div>
<div>&#187;<a href="gallery.html">Map&nbsp;gallery</a></div>

<div id="layout-menu-EXAMPLE"> EXAMPLES </div>
<div id="layout-menu-examples">
<div><a href="01_Species_Richness.html">Species_Richness</a></div>
<div><a href="02_SQL_and_R.html">SQL_and_R</a></div>
<div><a href="03_Range_Traits.html">Range_Traits</a></div>
<div><a href="04_Subsetting_1.html">Subsetting_1</a></div>
<div><a href="05_Subsetting_2.html">Subsetting_2</a></div>
<div><a href="06_Subsetting_3.html">Subsetting_3</a></div>
<div><a href="96_appendix_S5.html">appendix_S5</a></div>
<div><a href="97_appendix_S4.html">appendix_S4</a></div>
<div><a href="98_appendix_S3.html">appendix_S3</a></div>
<div><a href="99_appendix_S2.html">appendix_S2</a></div>

</div>

</div>
</div>

<div id="layout-content-box">

        <div id="layout-banner">
          <div id="layout-title">rangeMapper</div>
          <div id="layout-description">A platform for the study of macroecology of life history traits</div>
        </div>

<div id="layout-content">

        <div id="content">
<div class="sect2">
<h3 id="_appendix_s3">Appendix S3</h3>
<div class="sect3">
<h4 id="_supporting_information_in_em_valcu_m_james_d_kempenaers_b_rangemapper_a_platform_for_the_study_of_macroecology_of_life_history_traits_global_ecology_and_biogeography_in_press_2011_em">Supporting information in <em>Valcu, M., James. D, Kempenaers, B. rangeMapper: A platform for the study of macroecology of life history traits, Global Ecology and Biogeography, in press (2011)</em></h4>
<div class="sect4">
<h5 id="_case_study_2_geographical_variation_in_the_relationship_between_range_size_and_body_size">Case study 2: Geographical variation in the relationship between range size and body size</h5>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<img src="style/note.png" alt="Note" />
</td>
<td class="content">This script is updated to run using the latest version of the package (see footnote).</td>
</tr></table>
</div>
<div class="listingblock">
<div class="content">
<pre><tt> require(rangeMapper)
 # SET UP PROJECT
 td = tempdir()
 #Initiates a new rangeMapper project (wrens2.sqlite) to a temporary directory
 dbcon = rangeMap.start(file = "wrens2.sqlite", overwrite = TRUE, dir = td)</tt></pre>
</div></div>
<div class="listingblock">
<div class="content">
<pre><tt> #Location of the vector(*.shp) breeding ranges on disk
 branges = system.file(package = "rangeMapper", "extdata", "wrens", "vector_combined")</tt></pre>
</div></div>
<div class="listingblock">
<div class="content">
<pre><tt> # Saves the global bounding box as the union of all species bounding boxes.
 # For alternative methods to saving the global bounding box the see examples under ?rangeMapper
 global.bbox.save(con = dbcon, bbox = branges)</tt></pre>
</div></div>
<div class="listingblock">
<div class="content">
<pre><tt> # Saves the grid size (i.e. the size of a canvas cell) using the default value
 # The grid size can be specified by e.g. gridSize.save(dbcon, gridSize = 2.5)
 gridSize.save(dbcon, gridSize = 2.5)</tt></pre>
</div></div>
<div class="listingblock">
<div class="content">
<pre><tt> # Saves the canvas grid using the global bunding box and the grid size.
 canvas.save(dbcon)</tt></pre>
</div></div>
<div class="listingblock">
<div class="content">
<pre><tt> # Performs vector range maps interpolation with the canvas.
  r = readOGR(branges, "wrens", verbose = FALSE)
  processRanges(spdf = r, con =  dbcon, ID = "sci_name", metadata = rangeTraits() )</tt></pre>
</div></div>
<div class="listingblock">
<div class="content">
<pre><tt> # Uploads to the existing project a data.frame containing life history data.
 data(wrens)
 bio.save(con = dbcon, loc = wrens, ID = "sci_name")</tt></pre>
</div></div>
<div class="listingblock">
<div class="content">
<pre><tt> # Merge ranges parameters with life history data
 # This is an example on how to directly query a rangeMapper project
 RMQuery(dbcon, "CREATE TEMP VIEW IF NOT EXISTS
        BIO_temp AS Select * FROM
                BIO_wrens
                        JOIN metadata_ranges ON sci_name = bioid")

 # Then the temp. table is fetched and saved as a 'BIO' table</tt></pre>
</div></div>
<div class="listingblock">
<div class="content">
<pre><tt> # Alternatively you can fetch both tables and perform the join operation in R using 'merge'.
 wrens2 = RMQuery(dbcon, "select * from BIO_temp")
 wrens2$log_body_mass = log(wrens2$body_mass)
 bio.save(con = dbcon, loc = wrens2, ID = "sci_name")</tt></pre>
</div></div>
<div class="listingblock">
<div class="title"># DEFINE NEW FUNCTIONS</div>
<div class="content">
<pre><tt> # The newly defined functions should take 'formula' &amp; 'data' as arguments and should return a numeric vector of length 1
 # at this stage packages MASS and lme4 are need it.
 if(!require('MASS')) stop("Package MASS is not available")
 if(!require('lme4')) stop("Package lme4 is not available")</tt></pre>
</div></div>
<div class="listingblock">
<div class="content">
<pre><tt> # Slope of a robust regression (rlm function in MASS package)
  # ... allows for further arguments to be passed to rlm()
  # using try allows the computation to move on to the next canvas cell without stopping the entire process
  # the function will return NA if rlm does not return a coeficient.

 rlm_slope = function (formula, data,...) {
        x = try(as.numeric(
                rlm(formula, data,...)$coefficients[2]), silent = TRUE)
        if(inherits(x, "try-error")) x = NA
        return(x)
        }</tt></pre>
</div></div>
<div class="listingblock">
<div class="content">
<pre><tt> # Slope of a mixed-effect model (lmer function in lme4 package)
 lmer_slope = function (formula, data) {
        fm = try(lmer(formula, data = data), silent = TRUE)
        if (inherits(fm, "try-error"))
                res = NA
                        else res = fixef(fm)[2]
        as.numeric(res)
        }</tt></pre>
</div></div>
<div class="listingblock">
<div class="content">
<pre><tt> # CREATE MAPS using the user-defined functions
 rangeMap.save(dbcon, FUN = rlm_slope, biotab = "wrens2", biotrait = "log_body_mass",
        tableName = "rlm_slope_BM_rangeSize",
        formula = scale(log(Area)) ~ scale(log_body_mass),maxit = 20)
 rangeMap.save(dbcon, FUN = lmer_slope, biotab = "wrens2", biotrait = "log_body_mass",
        tableName = "lmer_slope_BM_rangeSize",
        formula = scale(log(Area)) ~ scale(log_body_mass)+(1|genus))</tt></pre>
</div></div>
<div class="listingblock">
<div class="title"># SHOW MAPS</div>
<div class="content">
<pre><tt> m= rangeMap.fetch(dbcon, c("rlm_slope_BM_rangeSize",
        "lmer_slope_BM_rangeSize" ))
 plot(m, style = "equal")</tt></pre>
</div></div>
<div class="imageblock">
<div class="content">
<img src="figs/98-014.jpg" alt="figs/98-014.jpg" />
</div>
</div>
<div class="listingblock">
<div class="content">
<pre><tt>[1] "R version 2.14.0 (2011-10-31)"
[1] "rangeMapper 0.0-6.6"
[1] "website generated using ascii 2.1"</tt></pre>
</div></div>
</div>
</div>
</div>
        </div>

        <div id="footnotes"><hr /></div>
        <div id="footer">

        <div id="footer-text">
Last updated 2011-11-30 16:15:01 W. Europe Standard Time
        </div>

<div id="footer-badges">
<a href="http://validator.w3.org/check?uri=referer"> <img style="border:0;width:88px;height:31px"
        src="http://www.w3.org/Icons/valid-xhtml11-blue" alt="Valid XHTML 1.1" height="31" width="88" /></a>
</div>
</div>
</div>
</div>



</body>
</html>
