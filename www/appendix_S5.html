<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN" "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd">
	<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
	<head>
	<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1" />
	<meta name="generator" content="AsciiDoc 8.6.6" />
	<title>rangeMapper</title> 
	<meta name="description" content="rangeMapper: A platform for the study of macroecology of life history traits">
	<meta name="author" content="Mihai Valcu">
	<meta name="keywords" content="macroecology, GIS, species richness, life history traits, rangeMapper, Aves,R, spatial analysis" />
	<link rel="stylesheet" href="style/style.css" type="text/css" />
	
	<!-- google-analytics -->
	<script type="text/javascript">

			  var _gaq = _gaq || [];
			  _gaq.push(["_setAccount", "UA-25987540-1"]);
			  _gaq.push(["_trackPageview"]);

			  (function() {
					var ga = document.createElement("script"); ga.type = "text/javascript"; ga.async = true;
					ga.src = ("https:" == document.location.protocol ? "https://ssl" : "http://www") + ".google-analytics.com/ga.js";
					var s = document.getElementsByTagName("script")[0]; s.parentNode.insertBefore(ga, s);
			  })();
	</script>
	
	<script src="style/syntaxHighlighter.js"> </script>
	
	</head>
	<body style="max-width:1024px">	
	
<div id="layout-leftBar"> <ul id="layout-leftBar" class="level1">
 <h4> rangeMapper </h4>
 <li><a href= "index.html" > home </a> </li>
 <li><a href= "FAQ.html" > FAQ </a> </li>
 <li><a href= "gui.html" > gui </a> </li>
 <li><a href= "Bibliography.html" > Bibliography </a> </li>
 <h4> Examples </h4>
 <li class="submenu"><a> Getting started </a> <ul class="level2"> <li><a href= "Species_Richness.html" > Species_Richness </a></li>
<li><a href= "on-the-fly reprojection.html" > on-the-fly reprojection </a></li>
<li><a href= "Range_Traits.html" > Range_Traits </a></li>
<li><a href= "Range_Traits2.html" > Range_Traits2 </a></li> </ul> </li>
 <li class="submenu"><a> Aggregate assambladges </a> <ul class="level2"> <li><a href= "SQL_functions.html" > SQL_functions </a></li>
<li><a href= "R_functions.html" > R_functions </a></li> </ul> </li>
 <li class="submenu"><a> Subsetting </a> <ul class="level2"> <li><a href= "Species.html" > Species </a></li>
<li><a href= "Assambladge.html" > Assambladge </a></li>
<li><a href= "Species & Assambladge.html" > Species & Assambladge </a></li> </ul> </li>
 <h4> Case studies </h4>
 <li class="submenu"><a> Valcu et al 2012 </a> <ul class="level2"> <li><a href= "appendix_S2.html" > appendix_S2 </a></li>
<li><a href= "appendix_S3.html" > appendix_S3 </a></li>
<li><a href= "appendix_S4.html" > appendix_S4 </a></li>
<li><a href= "appendix_S5.html" > appendix_S5 </a></li> </ul> </li>
 <li class="submenu"><a> NatureServe </a> <ul class="level2"> <li><a href= "Canidae.html" > Canidae </a></li>
<li><a href= "Falconidae.html" > Falconidae </a></li> </ul> </li>
 </ul></div>

<div id="layout-content-box"> <div id="layout-banner"> <div id="layout-title">rangeMapper</div><div id="layout-description">A platform for the study of macroecology of life history traits</div></div>
<h6> This script runs with  R version 2.15.1 (2012-06-22) & rangeMapper 0.1-7) </h6>

<h2>APPENDIX S5 </h2>

<p>Supporting information in  <em>Valcu, M., Dale, J., and Kempenaers, B. (2012). <br/>
rangeMapper: a platform for the study of macroecology of life-history traits. <br/>
Global Ecology and Biogeography 21, 945-951.</em></p>

<h2>Case study 3: The influence of range size on the relationship between species richness and body size</h2>

<pre><code class="r">require(rangeMapper)

# 1) SET UP PROJECT 
td = tempdir()
#Initiates a new rangeMapper project (wrens.sqlite) to a temporary directory 
dbcon = rangeMap.start(file = &quot;wrens3.sqlite&quot;, dir = td, overwrite = TRUE)

#Location of the vector(*.shp) breeding ranges on disk
branges = system.file(package = &quot;rangeMapper&quot;, &quot;extdata&quot;, 
                                    &quot;wrens&quot;, &quot;vector_combined&quot;)

# Uploads a data.frame containing life history data
data(wrens)
bio.save(con = dbcon, loc = wrens, ID = &quot;sci_name&quot;)

# Saves the global bounding box as the union of all species bounding boxes.
global.bbox.save(con = dbcon, bbox = branges)

# Saves the grid size (i.e. the size of a canvas cell) using the default value
gridSize.save(dbcon)
canvas.save(dbcon)

# Performs vector range maps interpolation with the canvas.
r = readOGR(branges, &quot;wrens&quot;, verbose = FALSE)
processRanges(spdf = r, con =  dbcon, ID = &quot;sci_name&quot;, metadata = rangeTraits() )

rangeMap.save(dbcon, tableName = &quot;species_richness&quot;)
</code></pre>

<pre><code class="r">
# 2) SET UP PARAMETERS 

W = 3   # size of the moving window

#  range size classes
mt = RMQuery(dbcon, &quot;SELECT * FROM metadata_ranges order by Area&quot;)

Q = quantile(log(mt$Area),  probs = seq(0.05, 1, 0.1) )
rangeA = data.frame(area = exp(Q), quant =  gsub(&quot;%&quot;, &quot;&quot;, names(Q)) )

output = vector(mode = &quot;list&quot;, length = nrow(rangeA))
names(output) = rangeA$quant
</code></pre>

<pre><code class="r">
# 3) Performs log10(median_body_mass) ~ sqrt(species_richness) regression
 # for each range size interval

for(i in seq(1:(nrow(rangeA) - W) ) ) {

    # Define  map subset
    area_subset =list(metadata_ranges = paste(&quot;Area between&quot;,  rangeA[i,&quot;area&quot;], 
    &quot;and&quot;, rangeA[i+W,&quot;area&quot;]))

    # Save map
    rangeMap.save(dbcon, subset = area_subset , biotab = &quot;wrens&quot;, 
    biotrait = &quot;body_mass&quot;, FUN = &quot;median&quot;, tableName = &quot;temp&quot;, 
    overwrite = TRUE)

    # Fetch map
    M = rangeMap.fetch( dbcon, c(&quot;species_richness&quot;, &quot;temp&quot;) )
    m  = as(M, &quot;SpatialPointsDataFrame&quot;)
    names(m) = c(c(&quot;species_richness&quot;, &quot;median_body_mass&quot;) )
    m = m[!is.na(m$median_body_mass) &amp; !is.na(m$species_richness), ]

    # Perform OLS regression
    # NOTE: In order to perform a spatial simultaneous autoregressive error
     # regression
    #  see &#39;errorsarlm &#39; function and the auxiliary neighbours list functions in 
     # &#39;spdep&#39; package.
    fm = lm( log10(median_body_mass) ~  sqrt(species_richness), m)

    output[[i]] =  fm

    print(i)
}

output = output[!sapply(output, is.null)]
</code></pre>

<pre><code class="r"># 3) EXTRACT REGGRESION PARAMETERS 

prm = lapply(output, function(x) data.frame(slope = coef(x)[2], 
              ci2.5 = confint(x)[2,1], ci97.5 = confint(x)[2,2]) )

prm = do.call(rbind, prm)
prm$rangeSize = as.numeric(row.names(prm))
</code></pre>

<p>Plot</p>

<pre><code class="r">require(Hmisc)
with(prm, errbar(rangeSize, slope, ci2.5, ci97.5) )
</code></pre>

<p><img src="data:image/png;base64,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" alt="plot of chunk unnamed-chunk-5"/> </p>

<p><footer>  Website built with <code>R version 2.15.1 (2012-06-22) , knitr 0.7 &amp; markdown 0.5.2</code> </footer> <br/>
                <footer> Last update <code>09/10/2012 09:23</code> , <a href="mailto:valcu@orn.mpg.de">valcu@orn.mpg.de</a> </footer> </p>

</div></div> <div id="footer"> <div id="footer-badge"> <a href="http://validator.w3.org/check?uri=referer"> <img style="border:0;width:88px;height:31px" src="http://www.w3.org/Icons/valid-xhtml11-blue" alt="Valid XHTML 1.1" height="31" width="88" /></a></div></div></body></html>
