<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN" "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">

<head>
<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1" />
<meta name="generator" content="AsciiDoc 8.6.6" />

<title></title>

<link rel="stylesheet" href="media/asciidoc.css" type="text/css" />
<link rel="stylesheet" href="media/layout2.css" type="text/css" />

<script type="text/javascript">

          var _gaq = _gaq || [];
          _gaq.push(['_setAccount', 'UA-25987540-1']);
          _gaq.push(['_trackPageview']);

          (function() {
                var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
                ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
                var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
          })();
</script>




</head>

<body style="max-width:1024px">

<div id="layout-menu-box">

        <div id="layout-menu">
          <div>&#187;<a href="index.html">Home</a></div>
          <div>&#187;<a href="faq.html">FAQ</a></div>
          <div>&#187;<a href="gui.html">GUI</a></div>
          <div>&#187;<a href="bibliography.html">Bibliography</a></div>
          <div>&#187;<a href="gallery.html">Map&nbsp;gallery</a></div>

          <div id="layout-menu-EXAMPLE"></div>
          <div><a href="#" class="tooltip"> <span>To run the examples copy/paste the code chuncks into R. </span>EXAMPLES</a></div>

<div id="layout-menu-examples">

<div><a href="01_canned.html"    class="tooltip"> <span>Species richness of the New World Wrens</span>Using defaults  </a></div>
<div><a href="02_sql_and_R.html" class="tooltip"> <span>Body size distribution of the New World Wrens</span>SQL vs. R </a></div>
<div><a href="03_rangeTraits.html" class="tooltip"> <span>Altidude range and the area-perimeter ratio of the New World Wrens</span>Range traits</a></div>


</div>


        </div>

</div>

<div id="layout-content-box">

        <div id="layout-banner">
          <div id="layout-title">rangeMapper</div>
          <div id="layout-description">A platform for the study of macroecology of life history traits</div>
        </div>

<div id="layout-content">

        <div id="content">
<div class="paragraph"><p>&gt;</p></div>
<div class="sect2">
<h3 id="_altidude_range_and_the_area_perimeter_ratio_of_the_new_world_wrens">Altidude range and the area perimeter ratio of the New World Wrens</h3>
<div class="sect3">
<h4 id="_range_traits_extraction">RANGE TRAITS EXTRACTION</h4>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<img src="media/note.png" alt="Note" />
</td>
<td class="content"><tt>processRanges()</tt> takes a <em>metadata</em> argument allowing for the extraction of
range parameters (e.g. range extent, range shape etc) and/or the extraction of
environmental parameters within the range (e.g. median temperature).
The <em>metadata</em> argument accepts a named list of functions. <tt>rangeTraits</tt> is a
convenience function for building up such a list.</td>
</tr></table>
</div>
<div class="listingblock">
<div class="content">
<pre><tt> #Start a new project
 require(rangeMapper)
 dbcon = rangeMap.start(file = "wrens.sqlite",dir = tempdir() , overwrite = TRUE)
 f = system.file(package = "rangeMapper", "extdata", "wrens", "vector_combined")
 projString =  CRS(" +proj=cea +lon_0=0 +lat_ts=30 +x_0=0+y_0=0 +ellps=WGS84 +units=m +no_defs")
 global.bbox.save(con = dbcon, bbox = f, p4s = projString)
 gridSize.save(dbcon)
 canvas.save(dbcon)</tt></pre>
</div></div>
<div class="olist arabic"><ol class="arabic">
<li>
<p>
#Area/Perimeter ratio
</p>
</li>
</ol></div>
<div class="listingblock">
<div class="content">
<pre><tt> APratio = function(x){
        # area
        A = sapply(slot(x, "polygons"),
                function(x) slot(x, "area") )
        # perimeter
        a = lapply(slot(x, "polygons"),
                function(x) slot(x, "Polygons") )
        b = do.call(c, a)
        a1 = lapply(b, function(x)
                Line(coordinates(x)))
        L = sapply(a1, LineLength)
        # A-P ratio
        2*(sqrt(pi*sum(A)))/sum(L)
 }</tt></pre>
</div></div>
<div class="olist arabic"><ol class="arabic">
<li>
<p>
# Altitude range
</p>
</li>
</ol></div>
<div class="listingblock">
<div class="content">
<pre><tt> dem = readGDAL(system.file(package = "rangeMapper", "extdata", "etopo1", "etopo1_Americas.tif"),  silent =  TRUE)
 # etopo1_Americas.tif data source:
 readChar(system.file(package = "rangeMapper", "extdata", "etopo1", "data_source.txt"), 500)</tt></pre>
</div></div>
<div class="paragraph"><p>[1] "Amante, C. and B. W. Eakins, ETOPO1 1 Arc-Minute Global Relief Model: Procedures, Data Sources and Analysis, National Geophysical Data Center, NESDIS, NOAA, U.S. Department of Commerce, Boulder, CO, August 2008. <a href="http://www.ngdc.noaa.gov/mgg/global/relief/ETOPO1/docs/ETOPO1.pdf\nImagery">http://www.ngdc.noaa.gov/mgg/global/relief/ETOPO1/docs/ETOPO1.pdf\nImagery</a> of ETOPO1 Ice Surface by J. Varner and E. Lim, Cooperative Institute for Research in Environmental Sciences, at University of Colorado at Boulder and NOAA National Geophysical Data Center."</p></div>
<div class="listingblock">
<div class="content">
<pre><tt> AltitRange = function(x) {
        sel = which(!is.na(overlay(dem, x)))
        if(length(sel) &gt; 0 ) {
        demx = dem[sel, ]
        res = diff(range(demx@data$band1, na.rm = TRUE))
        } else res = NA
        res
 }</tt></pre>
</div></div>
<div class="listingblock">
<div class="content">
<pre><tt> # Process ranges
 r = readOGR(f, "wrens", verbose = FALSE)
 processRanges(spdf = r, con =  dbcon, ID = "sci_name", metadata  = rangeTraits(APratio=APratio, AltitRange=AltitRange) )</tt></pre>
</div></div>
<div class="listingblock">
<div class="title"># Mapping metadata_ranges table</div>
<div class="content">
<pre><tt> # Convert metadata_ranges to a BIO table
 metadata2bio(dbcon)
 rangeMap.save(dbcon, biotab = "metadata_ranges", FUN = "median", biotrait = "APratio",
        tableName = "Area_Perimeter_ratio")
 rangeMap.save(dbcon, biotab = "metadata_ranges", FUN = "median", biotrait = "AltitRange",
        tableName = "Altitude_range")</tt></pre>
</div></div>
<div class="listingblock">
<div class="content">
<pre><tt> # Fetch and plot maps
 m = rangeMap.fetch(dbcon)
 plot(m)</tt></pre>
</div></div>
<div class="imageblock">
<div class="content">
<img src="figs/03-006.jpg" alt="figs/03-006.jpg" />
</div>
</div>
<div class="listingblock">
<div class="content">
<pre><tt>[1] "R version 2.14.0 (2011-10-31)"
[1] "rangeMapper 0.0-6.6"
[1] "website generated using ascii 2.1"</tt></pre>
</div></div>
</div>
</div>
        </div>

        <div id="footnotes"><hr /></div>
        <div id="footer">

        <div id="footer-text">
Last updated 2011-11-25 11:26:50 W. Europe Standard Time
        </div>

<div id="footer-badges">
<a href="http://validator.w3.org/check?uri=referer"> <img style="border:0;width:88px;height:31px"
        src="http://www.w3.org/Icons/valid-xhtml11-blue" alt="Valid XHTML 1.1" height="31" width="88" /></a>
</div>
</div>
</div>
</div>



</body>
</html>
