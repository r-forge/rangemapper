<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN" "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">

<head>
<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1" />
<meta name="generator" content="AsciiDoc 8.6.6" />

<title></title>

<link rel="stylesheet" href="style/asciidoc.css" type="text/css" />
<link rel="stylesheet" href="style/layout2.css" type="text/css" />
<link rel="stylesheet" href="style/dropdownMenu.css" type="text/css" />

<script type="text/javascript">

          var _gaq = _gaq || [];
          _gaq.push(['_setAccount', 'UA-25987540-1']);
          _gaq.push(['_trackPageview']);

          (function() {
                var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
                ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
                var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
          })();
</script>




</head>

<body style="max-width:1024px">

<div id="layout-menu-box">

<div id="layout-menu">
<div><a href="index.html">Home</a></div> <!-- &#187; -->
<div><a href="faq.html">FAQ</a></div>
<div><a href="gui.html">GUI</a></div>
<div><a href="bibliography.html">Bibliography</a></div>
<div><a href="gallery.html">Map&nbsp;gallery</a></div>

<div id="layout-menu-EXAMPLE"> EXAMPLES </div>
<div id="layout-menu-examples">
<ul class="menu menum">
<li class="menui0"> <a class="menui0" href="#"><span> Valcu_et_al </span></a>
<ul class="menum">
<li class="menui"><a class="menui" href= "00__Valcu_et_al__appendix_S2.html" > appendix_S2 </a></li>
<li class="menui"><a class="menui" href= "00__Valcu_et_al__appendix_S3.html" > appendix_S3 </a></li>
<li class="menui"><a class="menui" href= "00__Valcu_et_al__appendix_S4.html" > appendix_S4 </a></li>
<li class="menui"><a class="menui" href= "00__Valcu_et_al__appendix_S5.html" > appendix_S5 </a></li>
</ul>
</li>
<li class="menui0"><a class="menui0" href= "01__Species_Richness.html" > Species_Richness </a></li>
<li class="menui0"><a class="menui0" href= "02__SQL_and_R.html" > SQL_and_R </a></li>
<li class="menui0"><a class="menui0" href= "03__Range_Traits.html" > Range_Traits </a></li>
<li class="menui0"> <a class="menui0" href="#"><span> Subsetting </span></a>
<ul class="menum">
<li class="menui"><a class="menui" href= "04__Subsetting__1_Species_level.html" > 1_Species_level </a></li>
<li class="menui"><a class="menui" href= "04__Subsetting__2_Assambladge_level.html" > 2_Assambladge_level </a></li>
<li class="menui"><a class="menui" href= "04__Subsetting__3_Complex.html" > 3_Complex </a></li>
</ul>
</li>
<li class="menui0"> <a class="menui0" href="#"><span> NatureServe </span></a>
<ul class="menum">
<li class="menui"><a class="menui" href= "05__NatureServe__Falconidae.html" > Falconidae </a></li>
</ul>
</li>
</ul>

</div>

</div>
</div>

<div id="layout-content-box">

        <div id="layout-banner">
          <div id="layout-title">rangeMapper</div>
          <div id="layout-description">A platform for the study of macroecology of life history traits</div>
        </div>

<div id="layout-content">

        <div id="content">
<div class="sect2">
<h3 id="_appendix_s4">Appendix S4</h3>
<div class="sect3">
<h4 id="_supporting_information_in_strong_valcu_m_dale_j_kempenaers_b_strong_em_rangemapper_a_platform_for_the_study_of_macroecology_of_life_history_traits_global_ecology_and_biogeography_in_press_2011_em">Supporting information in <strong>Valcu, M., Dale, J., Kempenaers, B.</strong> <em>rangeMapper: A platform for the study of macroecology of life history traits, Global Ecology and Biogeography, in press (2011)</em></h4>
<div class="sect4">
<h5 id="_case_study_3_the_influence_of_grid_size_on_the_relationship_between_species_richness_and_body_size">Case study 3: The influence of grid size on the relationship between species richness and body size</h5>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<img src="style/tip.png" alt="Tip" />
</td>
<td class="content">This script runs with
R version 2.15.1 (2012-06-22) &amp; rangeMapper 0.1-7</td>
</tr></table>
</div>
<div class="listingblock">
<div class="content">
<pre><tt> require(rangeMapper)
 # 1) SET UP PROJECT
 td = tempdir()
 #Location of the vector(*.shp) breeding ranges on disk
 branges = system.file(package = "rangeMapper", "extdata", "wrens", "vector_combined")
 # Define grid size vector of increasing grid sizes.
 gridSizes = round(seq(from = 1, to = 4, length.out = 10), 2)
 # Load life history data
 data(wrens)</tt></pre>
</div></div>
<div class="listingblock">
<div class="content">
<pre><tt> # 2) Perform log10(median_body_mass) ~ sqrt(species_richness) regression
  # for each grid size

 output = list()
 for( i in 1:length(gridSizes) ) {

   dbcon = rangeMap.start(file = "temp.sqlite", dir = td, overwrite = TRUE)
   global.bbox.save(con = dbcon, bbox = branges)
   # The grid size is set along the values in 'gridSizes'
   gridSize.save(dbcon, gridSize = gridSizes[i])
   canvas.save(dbcon)

   processRanges(spdf = r, con =  dbcon, ID = "sci_name", metadata = rangeTraits() )

   bio.save(con = dbcon, loc = wrens, ID = "sci_name")

   # When rangeMap.save is called without extra arguments species richness
    # is saved by default
   rangeMap.save(dbcon)

   rangeMap.save(dbcon, FUN = 'median', biotab = "wrens", biotrait = "body_mass", tableName = "median_body_mass")

   map = rangeMap.fetch(dbcon,
        c("species_richness", "median_body_mass"))
   map = as(map, "SpatialPointsDataFrame")
   map = map[!is.na(map$median_body_mass) &amp;
                        !is.na(map$species_richness), ]


   # Perform OLS regression and save the output
   # NOTE: In order to perform a spatial simultaneous autoregressive error regression
   #  see 'errorsarlm ' function and the auxiliary neighbours list functions in 'spdep' package.
   output[[i]] = lm(log10(median_body_mass) ~ sqrt(species_richness), data= map)

   dbDisconnect(dbcon)
 }</tt></pre>
</div></div>
<div class="listingblock">
<div class="content">
<pre><tt> # 3) Extract regression parameters

 prm = lapply(output, function(x) data.frame(slope = coef(x)[2], ci2.5 = confint(x)[2,1], ci97.5 = confint(x)[2,2]) )
 prm = do.call(rbind, prm)
 # 4) PLOT
 if(!require(Hmisc) ) stop("package Hmisc is required for plotting")
 with(prm, errbar(gridSizes, slope, ci2.5, ci97.5) )</tt></pre>
</div></div>
<div class="imageblock">
<div class="content">
<img src="figs/97-004.jpg" alt="figs/97-004.jpg" />
</div>
</div>
<div class="tableblock">
<table rules="none"
width="100%"
frame="void"
cellspacing="0" cellpadding="4">
<col width="100%" />
<tbody>
<tr>
<td align="left" valign="top"><p class="table"><tt><em>Website built with R version 2.15.1 (2012-06-22) and the package “ascii” version 2.1</em></tt></p></td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div>
        </div>

        <div id="footnotes"><hr /></div>
        <div id="footer">

        <div id="footer-text">
Last updated 2012-08-11 15:23:30 W. Europe Daylight Time
        </div>

<div id="footer-badges">
<a href="http://validator.w3.org/check?uri=referer"> <img style="border:0;width:88px;height:31px"
        src="http://www.w3.org/Icons/valid-xhtml11-blue" alt="Valid XHTML 1.1" height="31" width="88" /></a>
</div>
</div>
</div>
</div>



</body>
</html>
